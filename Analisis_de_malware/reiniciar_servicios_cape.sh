#!/bin/bash

# Puede hacer falta editar para poner interfaz de red correcto en:
# /opt/CAPEv2/conf/kvm.conf 
# /opt/CAPEv2/conf/routing.conf

echo "Reiniciando servicios..."
sudo systemctl stop mongodb
sudo systemctl stop postgresql
sudo systemctl stop postgresql@13-main.service
sudo systemctl stop suricata
sudo systemctl stop suricata-update.timer
sudo systemctl stop cape-rooter.service
sudo systemctl stop cape
sudo systemctl stop cape-processor.service
sudo systemctl stop cape-web.service

sudo systemctl start mongodb
sudo systemctl start postgresql
sudo systemctl start postgresql@13-main.service
sudo systemctl start suricata
sudo systemctl start suricata-update.timer
sudo systemctl start cape-rooter.service
sudo systemctl start cape
sudo systemctl start cape-processor.service
sudo systemctl start cape-web.service

sudo chown -R cape:cape /var/run/suricata.pid
sudo chown -R cape:cape /var/run/suricata-command.socket

sudo systemctl restart cape-processor
echo "Servicios de uso de CAPEv2 reiniciados:"

echo -e "mongodb 		\c"; sudo systemctl status mongodb | grep "Active"
echo -e "postgresql 		\c"; sudo systemctl status postgresql | grep "Active"
echo -e "postgresql@13-main 	\c"; sudo systemctl status postgresql@13-main.service | grep "Active"
echo -e "suricata 		\c"; sudo systemctl status suricata | grep "Active"
echo -e "suricata-update.timer \c"; sudo systemctl status suricata-update.timer | grep "Active"
echo -e "cape-rooter.service 	\c"; sudo systemctl status cape-rooter.service | grep "Active"
echo -e "cape 			\c"; sudo systemctl status cape | grep "Active"
echo -e "cape-processor.service \c"; sudo systemctl status cape-processor.service | grep "Active"
echo -e "cape-web.service 	\c"; sudo systemctl status cape-web.service | grep "Active"


