#!/bin/bash
raiz=$(pwd)
target="malware"
clear
while [ "$(file $target | awk '{print $NF}')" == "directory" ]
do
file $target
cd $target/
ls | awk '{print "--->", NR, $0}'
echo "Seleccionar fichero o directorio: ... "
read opcion
target=$(ls | awk -v opcion=$opcion 'NR==opcion {print $0}')
ruta=$(pwd)/$target
done
echo "-------------------------------------- ( i ) -----------------------------------------"
echo "Fichero seleccionado y tipo: "
echo $(file $target)
echo "Ruta: $ruta"
echo "--------------------------------------------------------------------------------------"
echo "Resultados análisis:"
cd $raiz

#resultado=$(bash "/usr/local/bin/yara -C $raiz/rules-compiled $ruta")
resultado=$(yara -C rules-compiled malware/$target)

if [ "$resultado" == "" ]; then
	echo "No hay resultados."
else
	echo "###################################### / ! \ #########################################"
	echo "ATENCIÓN: MALWARE LOCALIZADO EN FICHERO:"
	echo $target
	echo "Con el siguiente resultado:"
	echo $resultado
	echo "######################################################################################"
fi


# /usr/local/bin/yara
